# vLLM Manager v6 â€” Embedded Engine
# Single process with AsyncLLMEngine (no subprocess)
# Pinned to v0.15.1 to avoid breaking changes from V0 removal
FROM vllm/vllm-openai:v0.15.1

# Install manager dependencies
COPY manager/requirements.txt /opt/vllm-manager/requirements.txt
RUN pip install --no-cache-dir -r /opt/vllm-manager/requirements.txt
RUN pip install --upgrade transformers
# Copy manager code
COPY manager/ /opt/vllm-manager/

# Environment
ENV MANAGER_PORT=8000
ENV VLLM_KEEP_ALIVE=5m
ENV VLLM_GPU_MEMORY_UTILIZATION=0.9
ENV VLLM_TENSOR_PARALLEL_SIZE=1
ENV PYTHONPATH=/opt/vllm-manager

EXPOSE 8000

# Single process - embedded engine, no subprocess
ENTRYPOINT ["python3", "-m", "main"]
WORKDIR /opt/vllm-manager